test:
  sequence:
    - service: notify.google_assistant
      data_template:
        message: >
          {% set time = (now().strftime("%l:%M")) | string%}{% set hour = (now().strftime("%l")) | int %}{% set mhour = (now().strftime("%H")) | int %}{% set minute = (now().strftime("%M")) | int %}Good{% if mhour < 12 %} morning.{% elif mhour < 18 %} afternoon.{% else %} evening.{% endif %} The current time is {{ time }}. The current temperature is {{states.sensor.dark_sky_temperature.state | round(0)}} degrees and the weather forecast for today is {{ states.sensor.pws_weather_1d.state | replace("High ", "High of ") | replace("Low ", "Low of ") }} {% set alerts = 0 %}{% if states.sensor.pws_alerts.attributes.Description != null and states.sensor.pws_alerts.attributes.Description != states.sensor.pws_alerts.attributes.Description_TOR and states.sensor.pws_alerts.attributes.Description != states.sensor.pws_alerts.attributes.Description_TOW and states.sensor.pws_alerts.attributes.Description != states.sensor.pws_alerts.attributes.Description_WRN and states.sensor.pws_alerts.attributes.Description != states.sensor.pws_alerts.attributes.Description_WAT and states.sensor.pws_alerts.attributes.Description != states.sensor.pws_alerts.attributes.Description_ADV and states.sensor.pws_alerts.attributes.Description != states.sensor.pws_alerts.attributes.Description_FLO and states.sensor.pws_alerts.attributes.Description != states.sensor.pws_alerts.attributes.Description_SPE %}{% set alerts = alerts+1 %}{% endif %}{% if states.sensor.pws_alerts.attributes.Description_TOR != null %}{% set alerts = alerts+1 %}{% endif %}{% if states.sensor.pws_alerts.attributes.Description_TOW != null %}{% set alerts = alerts+1 %}{% endif %}{% if states.sensor.pws_alerts.attributes.Description_WRN != null %}{% set alerts = alerts+1 %}{% endif %}{% if states.sensor.pws_alerts.attributes.Description_WAT != null %}{% set alerts = alerts+1 %}{% endif %}{% if states.sensor.pws_alerts.attributes.Description_ADV != null %}{% set alerts = alerts+1 %}{% endif %}{% if states.sensor.pws_alerts.attributes.Description_FLO != null %}{% set alerts = alerts+1 %}{% endif %}{% if states.sensor.pws_alerts.attributes.Description_SPE != null %}{% set alerts = alerts+1 %}{% endif %}{% if states.sensor.pws_alerts.state | int > 0 %}We are currently under a {% if states.sensor.pws_alerts.attributes.Description != null and states.sensor.pws_alerts.attributes.Description != states.sensor.pws_alerts.attributes.Description_TOR and states.sensor.pws_alerts.attributes.Description != states.sensor.pws_alerts.attributes.Description_TOW and states.sensor.pws_alerts.attributes.Description != states.sensor.pws_alerts.attributes.Description_WRN and states.sensor.pws_alerts.attributes.Description != states.sensor.pws_alerts.attributes.Description_WAT and states.sensor.pws_alerts.attributes.Description != states.sensor.pws_alerts.attributes.Description_ADV and states.sensor.pws_alerts.attributes.Description != states.sensor.pws_alerts.attributes.Description_FLO and states.sensor.pws_alerts.attributes.Description != states.sensor.pws_alerts.attributes.Description_SPE %}{{ states.sensor.pws_alerts.attributes.Description | replace(", ", " and a ")}}{% set alerts = alerts-1 %}{% if alerts > 1 %}, a {% elif alerts == 1 %} and a {% else %}.{% endif %}{% endif %}{% if states.sensor.pws_alerts.attributes.Description_TOR != null %}{{ states.sensor.pws_alerts.attributes.Description_TOR }}{% set alerts = alerts-1 %}{% if alerts > 1 %}, a {% elif alerts == 1 %} and a {% else %}.{% endif %}{% endif %}{% if states.sensor.pws_alerts.attributes.Description_TOW != null %}{{ states.sensor.pws_alerts.attributes.Description_TOW }}{% set alerts = alerts-1 %}{% if alerts > 1 %}, a {% elif alerts == 1 %} and a {% else %}.{% endif %}{% endif %}{% if states.sensor.pws_alerts.attributes.Description_WRN != null %}{{ states.sensor.pws_alerts.attributes.Description_WRN }}{% set alerts = alerts-1 %}{% if alerts > 1 %}, a {% elif alerts == 1 %} and a {% else %}.{% endif %}{% endif %}{% if states.sensor.pws_alerts.attributes.Description_WAT != null %}{{ states.sensor.pws_alerts.attributes.Description_WAT }}{% set alerts = alerts-1 %}{% if alerts > 1 %}, a {% elif alerts == 1 %} and a {% else %}.{% endif %}{% endif %}{% if states.sensor.pws_alerts.attributes.Description_ADV != null %}{{ states.sensor.pws_alerts.attributes.Description_ADV }}{% set alerts = alerts-1 %}{% if alerts > 1 %}, a {% elif alerts == 1 %} and a {% else %}.{% endif %}{% endif %}{% if states.sensor.pws_alerts.attributes.Description_FLO != null %}{{ states.sensor.pws_alerts.attributes.Description_FLO }}{% set alerts = alerts-1 %}{% if alerts > 1 %}, a {% elif alerts == 1 %} and a {% else %}.{% endif %}{% endif %}{% if states.sensor.pws_alerts.attributes.Description_SPE != null %}Severe Weather Advisory.{% endif %}{% endif %} {% if states.sensor.dark_sky_daily_high_temperature.state | int <= 45%}Don't forget your coat.{%endif%}{% if states.sensor.pws_precip_1d.state | int >= 50 %} Don't forget your umbrella.{% endif %}{% if states.calendar.tristans_calendar.attributes.message != '' %}{% set event_date = states.calendar.tristans_calendar.attributes.start_time.split(" ")[0] %}{% set event_time = states.calendar.tristans_calendar.attributes.start_time.split(" ")[1] %}{% set Y,M,D = event_date.split("-") %}{% set h,m,s =event_time.split(":") %}{% if (h|int) > 12%}{% set hh= (h|int)-12 %}{% set q= "pm" %}{% elif (h|int) == 12%}{% set hh= (h|int)%}{% set q= "pm" %}{% else %}{% set hh= (h|int)%}{% set q= "am"%}{% endif%}{% set spoken_time = (hh|string)+":"+(m|string)+q%}{% if states.calendar.tristans_calendar.attributes.all_day == true %}{% if (M | int)== (now().strftime("%-m") | int ) and (D| int)== (now().strftime("%-d")| int) %} Tristan has an all day event today titled {{states.calendar.tristans_calendar.attributes.message}}.{% elif ((now().strftime("%-d")|int)+1) == (D|int) %}Tristan has an all day event tomorrow titled {{states.calendar.tristans_calendar.attributes.message}}.{% endif %}{% else %}{% if (M | int)== (now().strftime("%-m") | int ) and (D| int)== (now().strftime("%-d")| int) %} Tristan has a calendar event today at {{spoken_time}} called {{states.calendar.tristans_calendar.attributes.message}}.{% elif ((now().strftime("%-d")|int)+1) == (D|int) %}Tristan has a calendar event tomorrow at {{spoken_time}} called {{states.calendar.tristans_calendar.attributes.message}}.{% else %}Tristan has a calendar event on {{M}}/{{D}} at {{spoken_time}} called {{states.calendar.tristans_calendar.attributes.message}}.{% endif %}{% endif %}{% endif %} {% if states.calendar.crystals_calendar.attributes.message != '' %}{% set event_date = states.calendar.crystals_calendar.attributes.start_time.split(" ")[0] %}{% set event_time = states.calendar.crystals_calendar.attributes.start_time.split(" ")[1] %}{% set Y,M,D = event_date.split("-") %}{% set h,m,s =event_time.split(":") %}{% if (h|int) > 12%}{% set hh= (h|int)-12 %}{% set q= "pm" %}{% elif (h|int) == 12%}{% set hh= (h|int)%}{% set q= "pm" %}{% else %}{% set hh= (h|int)%}{% set q= "am"%}{% endif%}{% set spoken_time = (hh|string)+":"+(m|string)+q%}{% if states.calendar.crystals_calendar.attributes.all_day == true %}{% if (M | int)== (now().strftime("%-m") | int ) and (D| int)== (now().strftime("%-d")| int) %} Crystal has an all day event today titled {{states.calendar.crystals_calendar.attributes.message}}.{% elif ((now().strftime("%-d")|int)+1) == (D|int) %}Crystal has an all day event tomorrow titled {{states.calendar.crystals_calendar.attributes.message}}.{% endif %}{% else %}{% if (M | int)== (now().strftime("%-m") | int ) and (D| int)== (now().strftime("%-d")| int) %} Crystal has a calendar event today at {{spoken_time}} called {{states.calendar.crystals_calendar.attributes.message}}.{% elif ((now().strftime("%-d")|int)+1) == (D|int) %}Tristan has a calendar event tomorrow at {{spoken_time}} called {{states.calendar.tristans_calendar.attributes.message}}.{% else %}Crystal has a calendar event on {{M}}/{{D}} at {{spoken_time}} called {{states.calendar.crystals_calendar.attributes.message}}.{% endif %}{% endif %}{% endif %}
