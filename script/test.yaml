test:
  sequence:
    - service: media_player.volume_set
      entity_id: media_player.livingroom_assistant
      data: 
        volume_level: 0.5
    - service: tts.google_say
      entity_id: media_player.livingroom_assistant
      data_template:
        message: >
          {% set event_date = states.calendar.tristans_calendar.attributes.start_time.split(" ")[0] %}
          {% set event_time = states.calendar.tristans_calendar.attributes.start_time.split(" ")[1] %}
          {% set Y,M,D = event_date.split("-") %}
          {% set h,m,s =event_time.split(":") %}
          {% if (h|int) > 12%}
            {% set hh= (h|int)-12 %}
            {% set q= "pm" %}
          {% else %}
            {% set hh= (h|int)%}
            {% set q= "am"%}
          {% endif%}

          {% if M==now().strftime("%-m") and D==now().strftime("%-d") %}
            You have a calendar event today at {{hh}}:{{m}}{{q}} called {{states.calendar.tristans_calendar.attributes.message}}.
          {% elif ((now().strftime("%-d")|int)+1) == (D|int) %}
            You have a calendar event tomorrow at {{hh}}:{{m}}{{q}} called {{states.calendar.tristans_calendar.attributes.message}}.
          {% else %}
            You have a calendar event on {{M | replace("12", "December") | replace("11", "November") | replace("10", "October") | replace("9", "September") | replace("8", "August") | replace("7", "July") | replace("6", "June") | replace("5", "May") | replace("4", "April") | replace("3", "March") | replace("2", "February") | replace("1", "January")}} {{D | replace("31","thirty first") | replace("30","thirtieth") | replace("29","twenty nineth") | replace("28","twenty eighth") | replace("27","twenty seventh") | replace("26","twenty sixth") | replace("25","twenty fifth") | replace("24","twenty fourth") | replace("23","twenty third") | replace("22","twenty second") | replace("21","twenty first") | replace("20","twentieth") | replace("19","nineteenth") | replace("18","eightteenth") | replace("17","seventeenth") | replace("16","sixteenth") | replace("15","fifteenth") | replace("14","fourteenth") | replace("13","thirteenth") | replace("12","twelfth") | replace("11","eleventh") | replace("10","tenth") | replace("09","nineth") | replace("08","eighth") | replace("07","seventh") | replace("06","sixth") | replace("05","fifth") | replace("04","fourth") | replace("03","third") | replace("02","second") | replace("01","first")}} at {{hh}}:{{m}}{{q}} called {{states.calendar.tristans_calendar.attributes.message}}.
          {% endif %}
