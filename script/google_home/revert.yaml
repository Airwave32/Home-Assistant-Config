revert:
  sequence:
  #Check if light is on, if it is, correct color temp and brightness and then turn it off
    - service_template: >
        {% if states.light.foyer.state == 'on' %}
          script.foyer_on
        {% else %} 
        {% endif %}
    - service: light.turn_off
      entity_id: light.foyer
  #If the TV is currently on, turn on the bias light and adjusts brightness and color temperature.
    - service_template: >
        {% if states.remote.livingroom.state == 'on' %}
          script.bias_light_on
        {% else %} 
           script.bias_light_off
        {% endif %}
  #If diningroom lights are on, correct color temp and brightness, then turn them off         
    - service_template: >
        {% if states.light.dining_room.state == 'on'%}
          script.diningroom_on
        {% endif %} 
    - service: light.turn_off
      entity_id: light.dining_room
  #Turn on livingroom lights to max brightness and the appropriate color temperature. 
    - service_template: >
        {% if states.input_boolean.movie_mode == 'on' %}
          script.movie_mode_on
        {% else %}
          script.livingroom_on
        {% endif %}
        
##############        
#STOPING POINT        
##############

  #If the bedroom lights are on, set them to the appropriate color temperature. 
    - service_template: >
        {% if states.light.master_bedroom.state == 'on' %}
          light.turn_on
        {% else %}
          light.turn_off
        {% endif %}
      entity_id: 
        - light.master_bedroom
      data_template:
        color_temp: >
          {% if (states.sensor.time.state | round(2)) <= 05.00 %}
            500
          {% elif (states.sensor.time.state | round(2)) <= 09.50 %}
            200
          {% elif (states.sensor.time.state | round(2)) >= 22.25 %}
            500
          {% elif states.sun.sun.attributes.elevation < 8 %}
            366
          {% elif (states.sensor.time.state | round(2)) > 9.50 %}
            300
          {% else %}
          {% endif %}
        brightness: >
          {% if states.media_player.bedroom_speaker.state == 'playing' or states.media_player.master_suite.state == 'playing' %}
            {% if states.media_player.bedroom_speaker.attributes.media_content_id.startswith('http://10.0.0.101/storage/whitenoise') or states.media_player.master_suite.attributes.media_content_id.startswith('http://10.0.0.101/storage/whitenoise') %}
            {% else %}
            {% endif %}
          {% else %}
            {% if states.sensor.time.state | int > 6 and states.sensor.time.state |int < 20 %}
              brightness: 254
            {% endif %}
          {% endif %}
  #Fix the pantry light
    - service: light.turn_on
      entity_id: light.pantry
      data_template: 
        brightness: >
          {% if (states.sensor.time.state | round(2)) <= 01.50 %}
            00
          {% elif (states.sensor.time.state | round(2)) <= 06.83 %}
            50
          {% elif (states.sensor.time.state | round(2)) <= 22.00 %}
            254
          {% elif (states.sensor.time.state | round(2)) >= 22.00 %}
            50
          {% else %}
          {% endif %}
  #Fix exterior lights
    - service_template: > 
        {% if states.sun.sun.attributes.elevation < 8 %}
          light.turn_on
        {% else %}
          light.turn_off
        {% endif %}
      entity_id: 
        - light.flood_lights
      data_template:
        brightness: >
          {% if (states.sensor.time.state | round(2)) <= 06.83 %}
            100
          {% else %}
            254
          {% endif %}
  #Fix the cabinet lights
    - service: light.turn_on
      entity_id: light.cabinet_lights
      data: 
        brightness: 254
      data_template:
        color_temp: >
          {% if (states.sensor.time.state | round(2)) <= 05.00 %}
            450
          {% elif (states.sensor.time.state | round(2)) <= 09.50 %}
            200
          {% elif (states.sensor.time.state | round(2)) >= 22.25 %}
            450
          {% elif states.sun.sun.attributes.elevation < 8 %}
            366
          {% elif (states.sensor.time.state | round(2)) > 9.50 %}
            300
          {% else %}
          {% endif %}
    - condition: time
      weekday:
        - sat
        - sun
    - service: light.turn_on
      entity_id: light.cabinet_lights
      data:
        xy_color: [0.1605,0.3299]
      data_template:
        brightness: >
          {{ states.light.living_room.attributes.brightness }}
