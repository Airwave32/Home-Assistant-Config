#- platform: wunderground
#  api_key: 1e3e716e93f82a3c
#  monitored_conditions:
#    - alerts
#    - weather_1d
#    - precip_1d
- platform: darksky
  api_key: !secret darksky
  latitude: !secret latitude
  longitude: !secret longitude
  monitored_conditions:
    - icon
    - daily_summary
    - summary
    - precip_probability
    - temperature
    - temperature_high
    - temperature_low
    - cloud_cover
    - uv_index
- platform: template
  sensors:
    uv_index:
      friendly_name: 'UV Index'
      value_template: '{{states.sensor.dark_sky_uv_index.state | int }}'
    current_temp:
      friendly_name: 'Current'
      value_template: '{{ states.sensor.dark_sky_temperature.state | round(0) }}'
      unit_of_measurement: '°F'
    high_temp:
      friendly_name: 'High'
      value_template: '{{ states.sensor.dark_sky_daytime_high_temperature.state | round(0) }}'
      unit_of_measurement: '°F'
    low_temp:
      friendly_name: 'Low'
      value_template: '{{ states.sensor.dark_sky_overnight_low_temperature.state | round(0) }}'
      unit_of_measurement: '°F'
    current_activity:
      friendly_name: 'Current Activity'
      value_template: '{{ states.remote.livingroom.attributes.current_activity }}'
    brightness_pantry:
      value_template: '{{ states.light.pantry.attributes.brightness }}'
    brightness_lr:
      value_template: '{{ states.light.living_room.attributes.brightness }}'
    color_temp_lr:
      value_template: '{{ states.light.living_room.attributes.xy_color }}'
    color_temp_br:
      value_template: '{{ states.light.master_bedroom.attributes.xy_color }}'
    color_temp_cl:
      value_template: '{{ states.light.cabinet_lights.attributes.xy_color }}'
    time:
      value_template: '{{(now().strftime("%H") | int) + (now().strftime("%M")|int / 60) | round(2)}}'
    protect_down:
      value_template: '{% if  states.sensor.downstairs_nest_protect_bedroom_battery_health.state == "Ok" and states.sensor.downstairs_nest_protect_bedroom_co_status.state == "Ok" and states.sensor.downstairs_nest_protect_bedroom_smoke_status.state == "Ok" %}Online{% elif states.sensor.kithen_nest_protect_bedroom_co_status.state == "Emergency" or states.sensor.downstairs_nest_protect_bedroom_smoke_status.state == "Emergency" %}Emergency {% elif states.sensor.downstairs_nest_protect_bedroom_battery_health.state == "Replace" %}Low Battery {% else %}Error{% endif %}'    
    protect_kitchen:
      value_template: '{% if  states.sensor.downstairs_nest_protect_kitchen_battery_health.state == "Ok" and states.sensor.downstairs_nest_protect_kitchen_co_status.state == "Ok" and states.sensor.downstairs_nest_protect_kitchen_smoke_status.state == "Ok" %}Online{% elif states.sensor.downstairs_nest_protect_kitchen_co_status.state == "Emergency" or states.sensor.downstairs_nest_protect_kitchen_smoke_status.state == "Emergency" %}Emergency {% elif states.sensor.downstairs_nest_protect_kitchen_battery_health.state == "Replace" %}Low Battery {% else %}Error{% endif %}'
    protect_up:
      value_template: '{% if  states.sensor.upstairs_nest_protect_hallway_battery_health.state == "Ok" and states.sensor.upstairs_nest_protect_hallway_co_status.state == "Ok" and states.sensor.upstairs_nest_protect_hallway_smoke_status.state == "Ok" %}Online{% elif states.sensor.kithen_nest_protect_hallway_co_status.state == "Emergency" or states.sensor.upstairs_nest_protect_hallway_smoke_status.state == "Emergency" %}Emergency {% elif states.sensor.upstairs_nest_protect_hallway_battery_health.state == "Replace" %}Low Battery {% else %}Error{% endif %}'      
    front_door:
      friendly_name: 'Front Door'
      value_template: '{% if is_state("binary_sensor.front_door", "off") %}Closed{% else %}Open{% endif %}'
      icon_template: '{% if is_state("binary_sensor.front_door", "off") %}mdi:door{% else %}mdi:door-open{% endif %}'
    back_door:
      friendly_name: 'Back Door'
      value_template: '{% if is_state("binary_sensor.back_door", "off") %}Closed{% else %}Open{% endif %}'
      icon_template: '{% if is_state("binary_sensor.back_door", "off") %}mdi:door{% else %}mdi:door-open{% endif %}'
    garage_door:
      friendly_name: 'Garage Door'
      value_template: '{% if is_state("binary_sensor.garage_door", "off") %}Closed{% else %}Open{% endif %}'
      icon_template: '{% if is_state("binary_sensor.garage_door", "off") %}mdi:door{% else %}mdi:door-open{% endif %}'
    front_windows:
      friendly_name: 'Front Windows'
      value_template: '{% if is_state("binary_sensor.front_windows", "off") %}Closed{% else %}Open{% endif %}'
      icon_template: '{% if is_state("binary_sensor.front_windows", "off") %}mdi:window-closed{% else %}mdi:window-open{% endif %}'
    back_windows:
      friendly_name: 'Back Windows'
      value_template: '{% if is_state("binary_sensor.back_windows", "off") %}Closed{% else %}Open{% endif %}'
      icon_template: '{% if is_state("binary_sensor.back_windows", "off") %}mdi:window-closed{% else %}mdi:window-open{% endif %}'
    bedroom_windows:
      friendly_name: 'Bedroom Windows'
      value_template: '{% if is_state("binary_sensor.bedroom_windows", "off") %}Closed{% else %}Open{% endif %}'
      icon_template: '{% if is_state("binary_sensor.bedroom_windows", "off") %}mdi:window-closed{% else %}mdi:window-open{% endif %}'
    huebridge:
      value_template: '{% if is_state("device_tracker.huebridge", "home") %}Online{% else %}Offline{% endif %}'
      friendly_name: 'Hue Bridge'
    harmonyhub:
      value_template: '{% if is_state("device_tracker.harmonyhub", "home") %}Online{% else %}Offline{% endif %}'
      friendly_name: 'Harmony Hub'
    smartthingshub:
      value_template: '{% if is_state("device_tracker.smartthingshub", "home") %}Online{% else %}Offline{% endif %}'
      friendly_name: 'SmartThings Hub'
    myq:
      value_template: '{% if is_state("device_tracker.myq", "home") %}Online{% else %}Offline{% endif %}'
      friendly_name: 'MyQ Bridge'
    macmini:
      value_template: '{% if is_state("device_tracker.macmini", "home") %}Online{% else %}Offline{% endif %}'
      friendly_name: 'Mac Mini'
    directv_genie:
      value_template: '{% if is_state("device_tracker.directv_genie", "home") %}Online{% else %}Offline{% endif %}'
      friendly_name: 'DirecTv Genie'
    google_home_livingroom:
      value_template: '{% if is_state("device_tracker.google_home_livingroom", "home") %}Online{% else %}Offline{% endif %}'
      friendly_name: 'Google Home (Livingroom)' 
    google_home_mini_kitchen:
      value_template: '{% if is_state("device_tracker.google_home_mini_kitchen", "home") %}Online{% else %}Offline{% endif %}'
      friendly_name: 'Google Home Mini (Kitchen)'  
    google_home_mini_bedroom:
      value_template: '{% if is_state("device_tracker.google_home_mini_bedroom", "home") %}Online{% else %}Offline{% endif %}'
      friendly_name: 'Google Home Mini (Bedroom)'
    google_home_mini_bathroom:
      value_template: '{% if is_state("device_tracker.google_home_mini_bathroom", "home") %}Online{% else %}Offline{% endif %}'
      friendly_name: 'Google Home Mini (Bathroom)' 
    chromecast_man_cave:
      value_template: '{% if is_state("device_tracker.chromecast_man_cave", "home") %}Online{% else %}Offline{% endif %}'
      friendly_name: 'Chromecast (Man Cave)'
    chromecast_audio_dining_room:
      value_template: '{% if is_state("device_tracker.chromecast_audio_dining_room", "home") %}Online{% else %}Offline{% endif %}'
      friendly_name: 'Chromecast Audio (Dining Room)'
    chromecast_audio_garage:
      value_template: '{% if is_state("device_tracker.chromecast_audio_garage", "home") %}Online{% else %}Offline{% endif %}'
      friendly_name: 'Chromecast Audio (Garage)'  
    viziocrave360:
      value_template: '{% if is_state("device_tracker.viziocrave360", "home") %}Online{% else %}Offline{% endif %}'
      friendly_name: 'Vizio Crave 360' 
    vizio_m70e3:
      value_template: '{% if is_state("device_tracker.vizio_m70e3", "home") %}Online{% else %}Offline{% endif %}'
      friendly_name: 'Vizio M70'
    lg_sj9:
      value_template: '{% if is_state("device_tracker.lg_sj9", "home") %}Online{% else %}Offline{% endif %}'
      friendly_name: 'LG SJ9' 
    rasplex:
      value_template: '{% if is_state("device_tracker.rasplex", "home") %}Online{% else %}Offline{% endif %}'
      friendly_name: 'RasPlex'
    nesthello:
      value_template: '{% if is_state("device_tracker.nest_hello", "home") %}Online{% else %}Offline{% endif %}'
      friendly_name: 'Nest Hello'
    lightifybridge:
      value_template: '{% if is_state("device_tracker.lightify_bridge", "home") %}Online{% else %}Offline{% endif %}'
      friendly_name: 'Lightify Bridge'
    away_toggle:
      value_template: '{% if is_state("input_boolean.disable_away_mode", "on") %}home{% else %}not_home{% endif %}'
      friendly_name: 'Away Toggle'     
- platform: random
  name: whitenoise
  minimum: 1
  maximum: 3
- platform: mqtt
  state_topic: "plex"
  name: "Rasplex Status"
  value_template: '{{ value_json.body }}'
- platform: dnsip
  scan_interval: 300
- platform: time_date
  display_options:
    - 'time'
- platform: rest
  resource: http://10.0.0.109:61208/api/2/quicklook/cpu
  name: "CPU Usage"
  value_template: '{{ value_json.cpu }}'
  unit_of_measurement: '%'
- platform: rest
  resource: http://10.0.0.109:61208/api/2/mem/percent
  name: "Memory Usage"
  value_template: '{{ value_json.percent }}'
  unit_of_measurement: '%'
- platform: rest
  resource: http://10.0.0.109:61208/api/2/fs
  name: Titan
  value_template: '{{ value_json[0].percent| round(1) }}'
  unit_of_measurement: '%'
- platform: rest
  resource: http://10.0.0.109:61208/api/2/fs
  name: Storage
  value_template: '{{ value_json[1].percent| round(1) }}'
  unit_of_measurement: '%'
- platform: rest
  resource: http://10.0.0.109:61208/api/2/fs
  name: Plex
  value_template: '{{ value_json[2].percent| round(1) }}'
  unit_of_measurement: '%'
- platform: command_line
  name: air_quality
  scan_interval:
    minutes: 10
  command: 'curl -X GET -H "Content-type: application/json" -H "Accept: application/json" "http://www.airnowapi.org/aq/observation/zipCode/current/?format=application/json&zipCode=38016&distance=25&API_KEY=BB4DF57E-645A-4867-935F-3BC241441002"'
  value_template: '{{value_json[0]["AQI"]}}'
